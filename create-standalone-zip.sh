#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ZIP –∞—Ä—Ö–∏–≤–∞ —Å–æ standalone —Å–±–æ—Ä–∫–æ–π
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./create-standalone-zip.sh

echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ ZIP –∞—Ä—Ö–∏–≤–∞ —Å–æ standalone —Å–±–æ—Ä–∫–æ–π..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –µ—Å—Ç—å
if [ ! -d ".next/standalone" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–∞–ø–∫–∞ .next/standalone –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "   –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞: npm run build"
    exit 1
fi

# –ò–º—è –∞—Ä—Ö–∏–≤–∞
ZIP_NAME="blck-site-standalone.zip"

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞—Ä—Ö–∏–≤ –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -f "$ZIP_NAME" ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è—é —Å—Ç–∞—Ä—ã–π –∞—Ä—Ö–∏–≤..."
    rm "$ZIP_NAME"
fi

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
TEMP_DIR=$(mktemp -d)
echo "üìÅ –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞: $TEMP_DIR"

# –ö–æ–ø–∏—Ä—É–µ–º standalone —Å–±–æ—Ä–∫—É
echo "üìã –ö–æ–ø–∏—Ä—É—é standalone —Å–±–æ—Ä–∫—É..."
cp -r .next/standalone/* "$TEMP_DIR/"

# –ö–æ–ø–∏—Ä—É–µ–º –ø–∞–ø–∫—É public (–Ω—É–∂–Ω–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
echo "üìã –ö–æ–ø–∏—Ä—É—é –ø–∞–ø–∫—É public..."
cp -r public "$TEMP_DIR/"

# –£–¥–∞–ª—è–µ–º .DS_Store –µ—Å–ª–∏ –µ—Å—Ç—å
find "$TEMP_DIR" -name ".DS_Store" -delete

# –°–æ–∑–¥–∞–µ–º ZIP
echo "üóúÔ∏è  –°–æ–∑–¥–∞—é ZIP –∞—Ä—Ö–∏–≤..."
cd "$TEMP_DIR"
zip -r "$ZIP_NAME" . -q
mv "$ZIP_NAME" "$OLDPWD/"

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
cd "$OLDPWD"
rm -rf "$TEMP_DIR"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä
SIZE=$(du -h "$ZIP_NAME" | cut -f1)
echo ""
echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: $ZIP_NAME"
echo "üìä –†–∞–∑–º–µ—Ä: $SIZE"
echo ""
echo "üìã –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:"
echo "  ‚úì .next/standalone/ (–≤—Å—è —Å–±–æ—Ä–∫–∞)"
echo "  ‚úì public/ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)"
echo ""
echo "üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:"
echo "   1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ $ZIP_NAME –Ω–∞ REG.RU"
echo "   2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –≤ –ø–∞–ø–∫—É public_html"
echo "   3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: node server.js"
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û:"
echo "   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ REG.RU —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Node.js 18+"
echo "   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ: node server.js (–≤ –ø–∞–ø–∫–µ –≥–¥–µ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–ª–∏)"
echo "   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ –ø–∞–Ω–µ–ª–∏: –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ = node server.js"
echo ""


